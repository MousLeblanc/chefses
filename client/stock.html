<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ChAIf SES - Gestion des Stocks</title>
  <body>
  <h1>Stock</h1>
  <button id="logout-btn">D√©connexion</button>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', () => {
          localStorage.removeItem('token');
          localStorage.removeItem('user');
          localStorage.removeItem('chaif-ses-session-start');
          window.location.href = 'index.html';
        });
      } else {
        console.error("Bouton de d√©connexion introuvable.");
      }
    });
  </script>
</body>


  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f5f5f5; color: #2c3e50; }
    header { background: #2c3e50; color: #fff; padding: 1.2rem 2rem; }
    .logo { font-size: 1.7rem; font-weight: bold; }
    nav ul { list-style: none; display: flex; gap: 1.5rem; }
    nav li a { color: #fff; text-decoration: none; transition: color .2s;}
    nav li a.active, nav li a:hover { color: #e67e22; }
    .container { max-width: 900px; margin: 2.5rem auto; background: #fff; border-radius: 12px; box-shadow: 0 3px 18px #0001; padding: 2rem; }
    h1 { margin-bottom: 1.4rem; }
    .inventory-header { text-align: right; margin-bottom: 1.2rem; }
    .btn, button { border: none; padding: 10px 18px; border-radius: 5px; cursor: pointer; font-weight: 600;}
    .btn-primary, .btn-success { background: #e67e22; color: #fff; }
    .btn-primary:hover, .btn-success:hover { background: #cf7712;}
    .stock-table { width: 100%; border-collapse: collapse; margin: 18px 0 8px 0;}
    .stock-table th, .stock-table td { padding: 10px 13px; border-bottom: 1px solid #eee; text-align: left;}
    .stock-table th { background: #f7f7f7; font-size: 1rem;}
    .stock-table tr:hover { background: #fcf4e7;}
    .btn-icon { background: none; border: none; cursor: pointer; color: #444; font-size: 1.05em; margin: 0 2px;}
    .btn-icon:hover { color: #e67e22;}
    #empty-stock-message { color: #aaa; text-align:center; padding: 32px 0;}
    .modal { display: none; position: fixed; z-index: 9999; top:0; left:0; width:100vw; height:100vh; background: rgba(44,62,80,0.15); justify-content: center; align-items: center;}
    .modal.show { display: flex;}
    .modal-content { background: #fff; border-radius: 10px; min-width: 320px; box-shadow: 0 6px 22px #0002; padding: 28px 22px;}
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;}
    .modal-title { font-weight: 600; font-size: 1.13rem;}
    .close-btn { background: none; border: none; font-size: 1.7rem; color: #aaa; cursor: pointer;}
    .close-btn:hover { color: #e67e22;}
    .form-group { margin-bottom: 1.1rem;}
    .form-control { width: 100%; padding: 9px 12px; border-radius: 4px; border: 1px solid #ccc;}
    .form-actions { display: flex; justify-content: flex-end; gap: 1rem;}
    .autocomplete-list { position: absolute; top:100%; left:0; width:100%; background:white; border:1px solid #ccc; z-index:20; box-shadow: 0 4px 14px #0001; display:none;}
    .autocomplete-item { padding: 9px 15px; cursor: pointer; font-size: 15px;}
    .autocomplete-item:hover { background: #eee;}
    #toast-container { position:fixed; bottom:20px; right:20px; z-index:20000;}
    .toast { background: #232b38; color:#fff; padding: 13px 22px; border-radius:4px; margin-bottom:6px; opacity:1; transition: opacity 0.3s;}
    .toast-success { background: #38b87c; }
    .toast-error { background: #e74c3c; }
  </style>
</head>
<body>
  <header>
    <div class="logo">ChAIf SES</div>
    <nav>
      <ul>
        <li><a href="accueil.html">Accueil</a></li>
        <li><a href="stock.html" class="active">Inventaire</a></li>
        <li><a href="menu.html">Menus</a></li>
        <li><a href="planning.html">Planning</a></li>
        <li><a href="suppliers.html">Fournisseurs</a></li>
        <li><a href="settings.html">Param√®tres</a></li>
        <li><a href="#" id="logout-btn">D√©connexion</a></li>
      </ul>
    </nav>
  </header>
  <div class="container">
    <h1>Gestion des Stocks</h1>
    <div class="inventory-header">
      <button id="add-item-btn" class="btn btn-primary">+ Ajouter un ingr√©dient</button>
    </div>
    <table class="stock-table">
      <thead>
        <tr>
          <th>Ingr√©dient</th>
          <th>Cat√©gorie</th>
          <th>Quantit√©</th>
          <th>Unit√©</th>
          <th>Date d'expiration</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="ingredient-list"></tbody>
    </table>
    <div id="empty-stock-message" style="display:none;">
      Aucun ingr√©dient enregistr√©.
    </div>
  </div>

  <!-- Modal d'ajout/modification -->
  <div id="item-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-title" id="modal-title">Ajouter un ingr√©dient</span>
        <button class="close-btn" id="close-modal-btn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="item-form" autocomplete="off">
          <input type="hidden" id="item-id" />
          <div class="form-group" style="position:relative;">
            <label for="item-name">Nom *</label>
            <input type="text" id="item-name" class="form-control" required autocomplete="off">
            <div class="autocomplete-list" id="modal-autocomplete"></div>
          </div>
          <div class="form-group">
            <label for="item-category">Cat√©gorie *</label>
            <select id="item-category" class="form-control" required>
              <option value="">S√©lectionnez une cat√©gorie</option>
              <option value="Viandes et Poissons">Viandes et Poissons</option>
              <option value="L√©gumes">L√©gumes</option>
              <option value="Fruits">Fruits</option>
              <option value="Produits Laitiers">Produits Laitiers</option>
              <option value="C√©r√©ales et F√©culents">C√©r√©ales et F√©culents</option>
              <option value="√âpices et Condiments">√âpices et Condiments</option>
            </select>
          </div>
          <div class="form-group">
            <label for="item-quantity">Quantit√© *</label>
            <input type="number" id="item-quantity" class="form-control" min="0" step="0.01" required>
          </div>
          <div class="form-group">
            <label for="item-unit">Unit√© *</label>
            <select id="item-unit" class="form-control" required>
              <option value="kg">kg</option>
              <option value="g">g</option>
              <option value="L">L</option>
              <option value="ml">ml</option>
              <option value="unit√©">unit√©</option>
              <option value="botte">botte</option>
            </select>
          </div>
          <div class="form-group">
            <label for="item-expiry">Date d'expiration</label>
            <input type="date" id="item-expiry" class="form-control">
          </div>
          <div class="form-actions">
            <button type="button" class="btn-primary" id="cancel-item-btn">Annuler</button>
            <button type="submit" class="btn-success">Enregistrer</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div id="toast-container"></div>
  <script>
    // Liste exhaustive (compl√®te selon tes besoins, raccourcie ici pour lisibilit√©)
    const INGREDIENTS_LIST = [
      "Ail","Artichaut","Asperge","Aubergine","Avocat","Carotte","C√©leri","Champignon","Chou","Chou-fleur","Concombre",
      "Courgette","√âchalote","Endive","√âpinard","Fenouil","Haricot vert","Laitue","Ma√Øs","Navet","Oignon",
      "Petit pois","Poireau","Poivron","Pomme de terre","Potiron","Radis","Salade","Tomate",
      "Abricot","Ananas","Banane","Cerise","Cl√©mentine","Fraise","Framboise","Grenade","Kiwi","Litchi","Mangue","Melon","Mirabelle","M√ªre","Myrtille","Nectarine","Orange","Pamplemousse","Past√®que","P√™che","Poire","Pomme","Prune","Raisin",
      "Poulet","Boeuf","Saumon","Cabillaud","Dorade","Crevette","Dinde","Jambon","Lait","Yaourt","Fromage","Beurre","Cr√®me fra√Æche",
      "Farine","Riz","P√¢tes","Pain","Couscous","Semoule","Quinoa","Sel","Poivre","Curry","Thym","Basilic","Persil",
      "Huile d'olive","Vinaigre","Citron","Orange","Noix","Chocolat","Caf√©","Th√©","Vin blanc","Vin rouge"
      // ...etc compl√®te si tu veux
    ];

    // LocalStorage DB helpers
    function loadStock() { return JSON.parse(localStorage.getItem('stock') || "[]"); }
    function saveStock(arr) { localStorage.setItem('stock', JSON.stringify(arr)); }

    // Rafra√Æchir tableau d'inventaire
    function refreshTable() {
      const data = loadStock();
      const tbody = document.getElementById('ingredient-list');
      tbody.innerHTML = "";
      if (!data.length) {
        document.getElementById('empty-stock-message').style.display = "block";
        return;
      } else {
        document.getElementById('empty-stock-message').style.display = "none";
      }
      data.forEach(ing => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${ing.nom}</td>
          <td>${ing.categorie}</td>
          <td>${ing.qte}</td>
          <td>${ing.unite}</td>
          <td>${ing.expiry || ""}</td>
          <td>
            <button class="btn-icon" .onmousedown="editItem('${ing.id}')">‚úèÔ∏è</button>
            <button class="btn-icon" .onmousedown="deleteItem('${ing.id}')">üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Ajout/√©dition
    document.getElementById('add-item-btn').onmousedown = () => {
      openModal();
    };
    document.getElementById('cancel-item-btn').onmousedown = closeModal;
    document.getElementById('close-modal-btn').onmousedown = closeModal;
    function openModal(editId = null) {
      document.getElementById('item-form').reset();
      document.getElementById('item-id').value = "";
      document.getElementById('modal-title').textContent = editId ? "Modifier un ingr√©dient" : "Ajouter un ingr√©dient";
      document.getElementById('item-modal').classList.add('show');
      if (editId) {
        const stock = loadStock();
        const item = stock.find(x => x.id === editId);
        if (item) {
          document.getElementById('item-id').value = item.id;
          document.getElementById('item-name').value = item.nom;
          document.getElementById('item-category').value = item.categorie;
          document.getElementById('item-quantity').value = item.qte;
          document.getElementById('item-unit').value = item.unite;
          document.getElementById('item-expiry').value = item.expiry || "";
        }
      }
      setTimeout(initModalAutocomplete, 100);
    }
    function closeModal() {
      document.getElementById('item-modal').classList.remove('show');
    }

    document.getElementById('item-form').onsubmit = function(e) {
      e.preventDefault();
      const id = document.getElementById('item-id').value || Date.now().toString();
      const nom = document.getElementById('item-name').value.trim();
      const categorie = document.getElementById('item-category').value;
      const qte = document.getElementById('item-quantity').value;
      const unite = document.getElementById('item-unit').value;
      const expiry = document.getElementById('item-expiry').value;
      let stock = loadStock();
      const idx = stock.findIndex(x => x.id === id);
      const obj = { id, nom, categorie, qte, unite, expiry };
      if (idx >= 0) stock[idx] = obj;
      else stock.push(obj);
      saveStock(stock);
      closeModal();
      showToast("Ingr√©dient enregistr√© !", "success");
      refreshTable();
    };
    window.editItem = openModal;
    window.deleteItem = id => {
      let stock = loadStock().filter(x => x.id !== id);
      saveStock(stock);
      showToast("Supprim√© !", "success");
      refreshTable();
    };

    // Autocompl√©tion champ modale
    function initModalAutocomplete() {
      const input = document.getElementById('item-name');
      const container = document.getElementById('modal-autocomplete');
      if (!input || !container) return;
      input.oninput = function () {
        const val = this.value.toLowerCase().trim();
        container.innerHTML = '';
        if (!val) { container.style.display = 'none'; return; }
        const found = INGREDIENTS_LIST.filter(ing => ing.toLowerCase().startsWith(val));
        found.slice(0, 12).forEach(ing => {
          const div = document.createElement('div');
          div.className = 'autocomplete-item';
          div.textContent = ing;
          div.onmousedown = function () {
            
            input.value = ing;
            container.innerHTML = '';
            container.style.display = 'none';
          };
          container.appendChild(div);
        });
        container.style.display = found.length ? 'block' : 'none';
      };
      input.onblur = function () { setTimeout(() => { container.style.display = 'none'; }, 150); };
    }

    // Toast simple
    function showToast(msg, type = "success") {
      let container = document.getElementById('toast-container');
      if (!container) return;
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `<span>${msg}</span>`;
      container.appendChild(toast);
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, 2200);
    }

    // Init page
  </script>
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', () => {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        localStorage.removeItem('chaif-ses-session-start');
        window.location.href = 'index.html';
      });
    }
  });
</script>

</body>
</html>
